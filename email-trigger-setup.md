# 📧 Gmail 觸發器系統設定指南

## 功能概述

這個系統會自動監控寄給 `qooaye03160617+vibe@gmail.com` 的信件，並執行以下動作：

1. **自動儲存**：將信件內容和附件儲存到 Google Drive 的「觸發器資料夾」
2. **發送確認信**：向該信箱發送處理完成的確認信
3. **錯誤通知**：如果處理失敗，發送錯誤通知

## 🚀 設定步驟

### 步驟 1: 建立 Google Apps Script 專案

1. 前往 [Google Apps Script](https://script.google.com)
2. 點選「新增專案」
3. 將專案命名為「Gmail 觸發器系統」

### 步驟 2: 新增程式碼

1. 刪除預設的 `function myFunction() {}` 程式碼
2. 複製 `email-trigger-system.gs` 的內容並貼上
3. 儲存專案 (Ctrl+S)

### 步驟 3: 設定權限

1. 點選「執行」按鈕執行任何函數
2. 授權以下權限：
   - Gmail API (讀取和發送信件)
   - Google Drive API (建立資料夾和檔案)
   - Google Apps Script (建立觸發器)

### 步驟 4: 初始化系統

1. 選擇 `initializeSystem` 函數
2. 點選「執行」
3. 查看執行記錄確認初始化成功

## 📋 主要功能

### 🔍 自動監控
- **監控頻率**：每5分鐘檢查一次
- **目標信箱**：`qooaye03160617+vibe@gmail.com`
- **處理範圍**：未讀信件

### 💾 自動儲存
- **儲存位置**：Google Drive / 觸發器資料夾
- **檔案格式**：
  ```
  20240714_143022_信件主旨.txt (主要信件內容)
  20240714_143022_信件主旨_附件/ (附件資料夾)
  ```

### 📮 確認信內容
```
主旨: [自動確認] 信件已收到並處理 - 原始主旨

內容:
- 處理時間
- 原始主旨和寄件者
- 儲存位置資訊
```

## 🛠 管理功能

### 查看觸發器狀態
```javascript
checkTriggerStatus()
```

### 手動執行處理
```javascript
manualRun()
```

### 測試系統功能
```javascript
testSystem()
```

### 重新建立觸發器
```javascript
createTimeTrigger()
```

### 刪除所有觸發器
```javascript
deleteExistingTriggers()
```

## 📊 檔案結構

### 信件儲存格式
```
觸發器資料夾/
├── 20240714_143022_訂單通知.txt
├── 20240714_143022_訂單通知_附件/
│   ├── 發票.pdf
│   └── 訂單明細.xlsx
├── 20240714_150315_系統通知.txt
└── ...
```

### 信件內容格式
```
=== 信件資訊 ===
收件時間: 2024/07/14 14:30:22
寄件者: sender@example.com
主旨: 重要通知
處理時間: 2024/07/14 14:30:45

=== 信件內容 ===
信件的完整文字內容...

=== 附件資訊 ===
附件 1: 文件.pdf (1024 bytes)
附件 2: 圖片.jpg (2048 bytes)
```

## ⚠️ 注意事項

### 權限需求
- **Gmail**：讀取信件、發送信件
- **Google Drive**：建立資料夾、建立檔案
- **Google Apps Script**：建立和管理觸發器

### 限制說明
- 每次最多處理 10 封信件
- 附件大小限制：25MB (Google Apps Script 限制)
- 檔案名稱會自動清理特殊字元

### 安全考量
- 系統只處理寄給指定信箱的信件
- 所有操作都有詳細記錄
- 錯誤時會自動發送通知

## 🔧 故障排除

### 常見問題

**Q: 觸發器沒有運作？**
A: 
1. 檢查觸發器是否正確建立：執行 `checkTriggerStatus()`
2. 重新建立觸發器：執行 `createTimeTrigger()`
3. 檢查 Google Apps Script 的執行記錄

**Q: 沒有收到確認信？**
A:
1. 檢查垃圾郵件資料夾
2. 確認 Gmail API 權限已授權
3. 查看執行記錄中的錯誤訊息

**Q: 檔案沒有儲存到 Google Drive？**
A:
1. 確認 Google Drive API 權限已授權
2. 檢查 Google Drive 的儲存空間
3. 執行 `testSystem()` 測試功能

### 手動測試
```javascript
// 測試系統功能
testSystem()

// 手動執行一次處理
manualRun()

// 檢查觸發器狀態
checkTriggerStatus()
```

## 📈 監控與維護

### 定期檢查
- 每週檢查一次觸發器狀態
- 定期清理舊的信件檔案
- 監控 Google Drive 儲存空間

### 效能優化
- 系統會自動標記已處理的信件
- 使用時間戳記避免重複處理
- 錯誤處理機制確保系統穩定

---

**系統建立時間**: 2024/07/14
**最後更新**: 2024/07/14
**版本**: 1.0