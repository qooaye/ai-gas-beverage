<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>50Âµê Á∂†Ëå∂ÈÄ£ÈéñÂ∞àË≥£Â∫ó - ÈªûÈ£≤ÊñôÁ≥ªÁµ±</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Microsoft JhengHei', sans-serif;
            background: linear-gradient(135deg, #4CAF50, #2196F3);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        .header {
            background: linear-gradient(45deg, #FFD700, #FFA500);
            padding: 20px;
            text-align: center;
            color: #333;
        }
        
        .header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
        }
        
        .content {
            padding: 30px;
        }
        
        .category {
            margin-bottom: 30px;
            border: 2px solid #e0e0e0;
            border-radius: 10px;
            overflow: hidden;
        }
        
        .category-header {
            background: #2196F3;
            color: white;
            padding: 15px 20px;
            font-size: 1.3em;
            font-weight: bold;
        }
        
        .menu-items {
            padding: 20px;
        }
        
        .menu-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            border-bottom: 1px solid #eee;
        }
        
        .menu-item:last-child {
            border-bottom: none;
        }
        
        .item-name {
            font-size: 1.1em;
            color: #333;
            flex: 1;
        }
        
        .size-options {
            display: flex;
            gap: 15px;
            align-items: center;
        }
        
        .size-btn {
            background: #4CAF50;
            color: white;
            border: none;
            padding: 8px 15px;
            border-radius: 20px;
            cursor: pointer;
            font-size: 0.9em;
            transition: all 0.3s;
        }
        
        .size-btn:hover {
            background: #45a049;
            transform: translateY(-2px);
        }
        
        .order-summary {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            max-width: 300px;
            z-index: 1000;
        }
        
        .order-header {
            background: #FF5722;
            color: white;
            padding: 15px;
            border-radius: 15px 15px 0 0;
            font-weight: bold;
        }
        
        .order-items {
            padding: 15px;
            max-height: 200px;
            overflow-y: auto;
        }
        
        .order-item-container {
            margin-bottom: 15px;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .order-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 8px;
            font-size: 0.9em;
        }
        
        .item-notes-section {
            margin-top: 5px;
        }
        
        .item-notes-input {
            width: 100%;
            padding: 5px 8px;
            border: 1px solid #ddd;
            border-radius: 3px;
            font-size: 0.8em;
            box-sizing: border-box;
        }
        
        .item-notes-input:focus {
            border-color: #4CAF50;
            outline: none;
        }
        
        .order-total {
            border-top: 2px solid #eee;
            padding: 15px;
            font-weight: bold;
            font-size: 1.1em;
        }
        
        .submit-btn {
            width: 100%;
            background: #4CAF50;
            color: white;
            border: none;
            padding: 15px;
            font-size: 1.1em;
            cursor: pointer;
            border-radius: 0 0 15px 15px;
        }
        
        .submit-btn:hover {
            background: #45a049;
        }
        
        .customer-section {
            margin: 15px 0;
        }
        
        .customer-input {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 1em;
            box-sizing: border-box;
        }
        
        .customer-input:focus {
            border-color: #4CAF50;
            outline: none;
            box-shadow: 0 0 5px rgba(76, 175, 80, 0.3);
        }
        
        .notes-section {
            margin: 15px 0;
        }
        
        .notes-input {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            resize: vertical;
            min-height: 80px;
        }
        
        .hidden {
            display: none;
        }
        
        .notification {
            position: fixed;
            top: 20px;
            right: 20px;
            background: #4CAF50;
            color: white;
            padding: 15px 25px;
            border-radius: 5px;
            z-index: 2000;
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from { transform: translateX(100%); }
            to { transform: translateX(0); }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üßã 50Âµê Á∂†Ëå∂ÈÄ£ÈéñÂ∞àË≥£Â∫ó</h1>
            <p>Ê≠°Ëøé‰ΩøÁî®Á∑ö‰∏äÈªûÈ£≤ÊñôÁ≥ªÁµ±</p>
        </div>
        
        <div class="content">
            <div id="menu-container"></div>
        </div>
    </div>
    
    <div class="order-summary" id="orderSummary">
        <div class="order-header">
            üõí ÊÇ®ÁöÑË®ÇÂñÆ
        </div>
        <div class="order-items" id="orderItems">
            <p style="text-align: center; color: #999;">Â∞öÊú™ÈÅ∏Êìá‰ªª‰ΩïÈ£≤Êñô</p>
        </div>
        <div class="customer-section">
            <input type="text" class="customer-input" id="customerName" placeholder="Ë´ãËº∏ÂÖ•ÂßìÂêç" maxlength="20">
        </div>
        <div class="order-total" id="orderTotal">
            Á∏ΩË®à: $0
        </div>
        <button class="submit-btn" onclick="submitOrder()">ÈÄÅÂá∫Ë®ÇÂñÆ</button>
    </div>

    <script>
        let orderData = [];
        let total = 0;
        
        function loadMenu() {
            // Ê™¢Êü•ÊòØÂê¶Âú® Google Apps Script Áí∞Â¢É‰∏≠
            if (typeof google !== 'undefined' && google.script) {
                google.script.run.withSuccessHandler(displayMenu).getMenuData();
            } else {
                // Â¶ÇÊûú‰∏çÂú® GAS Áí∞Â¢ÉÔºå‰ΩøÁî®Êú¨Âú∞Ê∏¨Ë©¶Ë≥áÊñô
                const testMenuData = {
                    "ÊâæÂ•ΩËå∂": [
                        {"name": "ËåâËéâÁ∂†Ëå∂", "m": 25, "l": 30},
                        {"name": "ÈòøËñ©ÂßÜÁ¥ÖËå∂", "m": 25, "l": 30},
                        {"name": "ÂõõÂ≠£Êò•ÈùíËå∂", "m": 25, "l": 30},
                        {"name": "ÈªÉÈáëÁÉèÈæç", "m": 25, "l": 30},
                        {"name": "1Ëôü(ÂõõÂ≠£Êò•ÁèçÊ≥¢Ê§∞)", "m": 30, "l": 40},
                        {"name": "Ê≥¢Èú∏Á∂†/Á¥Ö", "m": 30, "l": 40},
                        {"name": "ÂæÆÊ™∏Ê™¨Á¥Ö/Èùí", "m": 30, "l": 40},
                        {"name": "Ê™∏Ê™¨Á∂†/Èùí", "m": 35, "l": 50},
                        {"name": "Ê¢Ö„ÅÆÁ∂†", "m": 35, "l": 50},
                        {"name": "8ÂÜ∞Á∂†", "m": 35, "l": 50},
                        {"name": "Â§öÂ§öÁ∂†", "m": 35, "l": 50},
                        {"name": "ÂÜ∞Ê∑áÊ∑ãÁ¥ÖËå∂", "m": 35, "l": 50},
                        {"name": "ÊüöÂ≠êÁ¥Ö", "m": 35, "l": 50},
                        {"name": "Êó∫‰æÜÁ¥Ö", "m": 35, "l": 50},
                        {"name": "ÈÆÆÊüöÁ∂†(Â≠£ÁØÄÈôêÂÆö:4-8ÊúàÔºå10-1Êúà)", "m": 45, "l": 60}
                    ],
                    "ÊâæÂ•∂Ëå∂": [
                        {"name": "Â•∂Ëå∂", "m": 35, "l": 50},
                        {"name": "Â•∂Á∂†", "m": 35, "l": 50},
                        {"name": "ÁÉèÈæçÂ•∂", "m": 35, "l": 50},
                        {"name": "ÁèçÁè†Â•∂Ëå∂", "m": 35, "l": 50},
                        {"name": "ÁèçÁè†Â•∂Á∂†", "m": 35, "l": 50},
                        {"name": "Ê≥¢Èú∏Â•∂Ëå∂", "m": 35, "l": 50},
                        {"name": "Ê≥¢Èú∏Â•∂Á∂†", "m": 35, "l": 50},
                        {"name": "ÁáïÈ∫•Â•∂Ëå∂", "m": 35, "l": 50},
                        {"name": "Á¥ÖËå∂Áë™Â•áÊúµ(ÈÆÆÂ•∂Ê≤π)", "m": 35, "l": 50},
                        {"name": "Ê§∞ÊûúÂ•∂Ëå∂", "m": 35, "l": 50},
                        {"name": "Ê§∞ÊûúÂ•∂Á∂†", "m": 35, "l": 50},
                        {"name": "ÈòøËèØÁî∞", "m": 40, "l": 55},
                        {"name": "ÂÜ∞Ê∑áÊ∑ãÂ•∂Ëå∂", "m": 45, "l": 60}
                    ],
                    "ÊâæÊãøÈêµ": [
                        {"name": "Á¥ÖËå∂ÊãøÈêµ", "m": 45, "l": 60},
                        {"name": "ÁèçÁè†Á¥ÖËå∂ÊãøÈêµ", "m": 45, "l": 60},
                        {"name": "Ê≥¢Èú∏Á¥ÖËå∂ÊãøÈêµ", "m": 45, "l": 60},
                        {"name": "ÁáïÈ∫•Á¥ÖËå∂ÊãøÈêµ", "m": 45, "l": 60},
                        {"name": "ÈòøËèØÁî∞ÊãøÈêµ", "m": 50, "l": 70},
                        {"name": "ÂÜ∞Ê∑áÊ∑ãÁ¥ÖËå∂ÊãøÈêµ", "m": 50, "l": 70}
                    ],
                    "ÊâæÊñ∞ÈÆÆ": [
                        {"name": "8ÂÜ∞Ëå∂", "m": 35, "l": 50},
                        {"name": "ÊüöÂ≠êËå∂", "m": 35, "l": 50},
                        {"name": "Ê™∏Ê™¨Ê±Å", "m": 45, "l": 60},
                        {"name": "Ëë°ËêÑÊüöÊ±Å(Â≠£ÁØÄÈôêÂÆö:4-8ÊúàÔºå10-1Êúà)", "m": 45, "l": 60},
                        {"name": "ÈáëÊ°îÊ™∏Ê™¨", "m": 45, "l": 60},
                        {"name": "Ê™∏Ê™¨Ê¢ÖÊ±Å", "m": 45, "l": 60},
                        {"name": "Ê™∏Ê™¨Â§öÂ§ö", "m": 50, "l": 70},
                        {"name": "Ëë°ËêÑÊüöÂ§öÂ§ö(Â≠£ÁØÄÈôêÂÆö:4-8ÊúàÔºå10-1Êúà)", "m": 50, "l": 70}
                    ]
                };
                displayMenu(testMenuData);
                
                // È°ØÁ§∫Ê∏¨Ë©¶Ê®°ÂºèÊèêÁ§∫
                showNotification('ÁõÆÂâçÁÇ∫Ê∏¨Ë©¶Ê®°ÂºèÔºåË´ãÈÉ®ÁΩ≤Âà∞ Google Apps Script Âæå‰ΩøÁî®', 'info');
            }
        }
        
        function displayMenu(menuData) {
            const container = document.getElementById('menu-container');
            
            Object.keys(menuData).forEach(category => {
                const categoryDiv = document.createElement('div');
                categoryDiv.className = 'category';
                
                const categoryHeader = document.createElement('div');
                categoryHeader.className = 'category-header';
                categoryHeader.textContent = category;
                
                const menuItems = document.createElement('div');
                menuItems.className = 'menu-items';
                
                menuData[category].forEach(item => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'menu-item';
                    
                    const itemName = document.createElement('div');
                    itemName.className = 'item-name';
                    itemName.textContent = item.name;
                    
                    const sizeOptions = document.createElement('div');
                    sizeOptions.className = 'size-options';
                    
                    const mBtn = document.createElement('button');
                    mBtn.className = 'size-btn';
                    mBtn.textContent = `‰∏≠ÊùØ $${item.m}`;
                    mBtn.onclick = () => addToOrder(item.name, 'M', item.m);
                    
                    const lBtn = document.createElement('button');
                    lBtn.className = 'size-btn';
                    lBtn.textContent = `Â§ßÊùØ $${item.l}`;
                    lBtn.onclick = () => addToOrder(item.name, 'L', item.l);
                    
                    sizeOptions.appendChild(mBtn);
                    sizeOptions.appendChild(lBtn);
                    
                    itemDiv.appendChild(itemName);
                    itemDiv.appendChild(sizeOptions);
                    
                    menuItems.appendChild(itemDiv);
                });
                
                categoryDiv.appendChild(categoryHeader);
                categoryDiv.appendChild(menuItems);
                container.appendChild(categoryDiv);
            });
        }
        
        function addToOrder(itemName, size, price) {
            const existingIndex = orderData.findIndex(item => 
                item.item === itemName && item.size === size && !item.itemNotes
            );
            
            if (existingIndex >= 0) {
                orderData[existingIndex].quantity += 1;
                orderData[existingIndex].total = orderData[existingIndex].quantity * price;
            } else {
                orderData.push({
                    item: itemName,
                    size: size,
                    price: price,
                    quantity: 1,
                    total: price,
                    itemNotes: '' // ÊØèÂÄãÈ£≤ÊñôÁöÑÁç®Á´ãÂÇôË®ª
                });
            }
            
            updateOrderDisplay();
        }
        
        function updateOrderDisplay() {
            const orderItems = document.getElementById('orderItems');
            const orderTotal = document.getElementById('orderTotal');
            
            if (orderData.length === 0) {
                orderItems.innerHTML = '<p style="text-align: center; color: #999;">Â∞öÊú™ÈÅ∏Êìá‰ªª‰ΩïÈ£≤Êñô</p>';
                total = 0;
            } else {
                orderItems.innerHTML = '';
                total = 0;
                
                orderData.forEach((item, index) => {
                    const itemDiv = document.createElement('div');
                    itemDiv.className = 'order-item-container';
                    itemDiv.innerHTML = `
                        <div class="order-item">
                            <div>
                                <div>${item.item} (${item.size})</div>
                                <div style="font-size: 0.8em; color: #666;">$${item.price} √ó ${item.quantity}</div>
                            </div>
                            <div>
                                <button onclick="changeQuantity(${index}, -1)" style="background: #f44336; color: white; border: none; padding: 2px 6px; border-radius: 3px; cursor: pointer;">-</button>
                                <span style="margin: 0 8px;">$${item.total}</span>
                                <button onclick="changeQuantity(${index}, 1)" style="background: #4CAF50; color: white; border: none; padding: 2px 6px; border-radius: 3px; cursor: pointer;">+</button>
                            </div>
                        </div>
                        <div class="item-notes-section">
                            <input type="text" class="item-notes-input" placeholder="È£≤ÊñôÂÇôË®ª (Á≥ñÂ∫¶„ÄÅÂÜ∞Â°äÁ≠â)" 
                                value="${item.itemNotes || ''}" onchange="updateItemNotes(${index}, this.value)" 
                                maxlength="50">
                        </div>
                    `;
                    orderItems.appendChild(itemDiv);
                    total += item.total;
                });
            }
            
            orderTotal.textContent = `Á∏ΩË®à: $${total}`;
        }
        
        function changeQuantity(index, change) {
            orderData[index].quantity += change;
            
            if (orderData[index].quantity <= 0) {
                orderData.splice(index, 1);
            } else {
                orderData[index].total = orderData[index].quantity * orderData[index].price;
            }
            
            updateOrderDisplay();
        }
        
        function updateItemNotes(index, notes) {
            if (orderData[index]) {
                orderData[index].itemNotes = notes;
            }
        }
        
        function submitOrder() {
            if (orderData.length === 0) {
                alert('Ë´ãÂÖàÈÅ∏ÊìáÈ£≤ÊñôÔºÅ');
                return;
            }
            
            const customerName = document.getElementById('customerName').value.trim();
            
            // Ê™¢Êü•ÊòØÂê¶ÊúâËº∏ÂÖ•ÂßìÂêç
            if (!customerName) {
                alert('Ë´ãËº∏ÂÖ•ÊÇ®ÁöÑÂßìÂêçÔºÅ');
                document.getElementById('customerName').focus();
                return;
            }
            
            if (typeof google !== 'undefined' && google.script) {
                // Ê∫ñÂÇôÂÆåÊï¥Ë®ÇÂñÆË≥áÊñô
                const fullOrder = orderData.map(item => ({
                    item: item.item || 'Êú™Áü•ÂìÅÈ†Ö',
                    size: item.size || 'Êú™Áü•Â∞∫ÂØ∏',
                    price: parseInt(item.price) || 0,
                    quantity: parseInt(item.quantity) || 1,
                    total: parseInt(item.total) || 0,
                    itemNotes: item.itemNotes || '',
                    customerName: customerName
                }));
                
                console.log('Ê∫ñÂÇôÈÄÅÂá∫ÂÆåÊï¥Ë®ÇÂñÆ:', fullOrder);
                
                // ‰∏ÄÊ¨°ÈÄÅÂá∫Êï¥Á≠ÜË®ÇÂñÆ
                google.script.run
                    .withSuccessHandler(function(response) {
                        console.log('ÂÆåÊï¥Ë®ÇÂñÆÈÄÅÂá∫ÊàêÂäü:', response);
                        showNotification(`Ë®ÇÂñÆÈÄÅÂá∫ÊàêÂäüÔºÅ${response.orderId || ''}`);
                        orderData = [];
                        total = 0;
                        updateOrderDisplay();
                        document.getElementById('customerName').value = '';
                    })
                    .withFailureHandler(function(error) {
                        console.error('Ë®ÇÂñÆÈÄÅÂá∫Â§±Êïó:', error);
                        showNotification('Ë®ÇÂñÆÈÄÅÂá∫Â§±ÊïóÔºåË´ãÈáçË©¶ÔºÅ', 'error');
                    })
                    .submitFullOrder(fullOrder);
                    
            } else {
                // Ê∏¨Ë©¶Ê®°ÂºèÔºöÊ®°Êì¨Ë®ÇÂñÆÈÄÅÂá∫
                console.log('Ê∏¨Ë©¶Ê®°Âºè - ÂÆåÊï¥Ë®ÇÂñÆË≥áÊñô:', orderData);
                showNotification('Ê∏¨Ë©¶Ê®°ÂºèÔºöÂÆåÊï¥Ë®ÇÂñÆÂ∑≤Ë®òÈåÑÂà∞ÁÄèË¶ΩÂô®ÊéßÂà∂Âè∞', 'info');
                orderData = [];
                total = 0;
                updateOrderDisplay();
                document.getElementById('customerName').value = '';
            }
        }
        
        function onAllOrdersSuccess() {
            showNotification('ÊâÄÊúâË®ÇÂñÆÈÄÅÂá∫ÊàêÂäüÔºÅ');
            orderData = [];
            total = 0;
            updateOrderDisplay();
            document.getElementById('orderNotes').value = '';
        }
        
        function onOrderSuccess(response) {
            showNotification('Ë®ÇÂñÆÈÄÅÂá∫ÊàêÂäüÔºÅ');
            orderData = [];
            total = 0;
            updateOrderDisplay();
            document.getElementById('orderNotes').value = '';
        }
        
        function onOrderError(error) {
            showNotification('Ë®ÇÂñÆÈÄÅÂá∫Â§±ÊïóÔºåË´ãÈáçË©¶ÔºÅ', 'error');
        }
        
        function showNotification(message, type = 'success') {
            const notification = document.createElement('div');
            notification.className = 'notification';
            
            if (type === 'error') {
                notification.style.background = '#f44336';
            } else if (type === 'info') {
                notification.style.background = '#2196F3';
            } else {
                notification.style.background = '#4CAF50';
            }
            
            notification.textContent = message;
            
            document.body.appendChild(notification);
            
            setTimeout(() => {
                if (document.body.contains(notification)) {
                    document.body.removeChild(notification);
                }
            }, 5000);
        }
        
        window.onload = loadMenu;
    </script>
</body>
</html>